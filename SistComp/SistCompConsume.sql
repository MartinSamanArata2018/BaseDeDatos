USE iVentas;

SELECT * FROM PERSONA;
SELECT * FROM MARCA;
SELECT * FROM MODELO;
SELECT * FROM PRODUCTO;
SELECT * FROM VENTA WHERE VENTA.TIPVEN ='B' ORDER BY CODVEN ASC ;
SELECT * FROM VENTA WHERE VENTA.TIPVEN ='F' ORDER BY CODVEN ASC ;
SELECT * FROM STOCK;
SELECT * FROM VENTA;

SELECT * FROM VENTA_DETALLE;

/*PERSONA + LOGIN*/
SELECT PERSONA.CODPER, PERSONA.NOMPER, PERSONA.APEPER, PERSONA.DNIPER, PERSONA.TLFPER, LOGIN.USRLOG, LOGIN.PSWLOG, LOGIN.ESTLOG, PERSONA.TIPPER FROM PERSONA INNER JOIN LOGIN ON PERSONA.CODPER = LOGIN.PERSONA_CODPER ;

/*PRODUCTO + MARCA + MODELO*/
SELECT PRODUCTO.CODPRO, PRODUCTO.NOMPRO, MARCA.NOMMAR, MODELO.NOMMOD, PRODUCTO.SERPRO, PRODUCTO.PREPRO, PRODUCTO.URLIMGPRO
FROM PRODUCTO
INNER JOIN MODELO ON PRODUCTO.MODELO_CODMOD_MODPRO = MODELO.CODMOD
INNER JOIN MARCA ON MODELO.MARCA_CODMAR_MARMOD = MARCA.CODMAR;

/*MARCA + MODELO*/
SELECT MODELO.NOMMOD
FROM MODELO
INNER JOIN MARCA ON MODELO.MARCA_CODMAR = MARCA.CODMAR
WHERE MARCA.NOMMAR='DELL';

/*PROVINCIAS DEPENDIENTES DE DEPARTAMENTO*/
SELECT PROVINCIA.NOMPROV 
FROM PROVINCIA
INNER JOIN DEPARTAMENTO ON PROVINCIA.DEPARTAMENTO_CODDEP = DEPARTAMENTO.CODDEP
WHERE DEPARTAMENTO.NOMDEP = 'LIMA';

/*DISTRITO DEPENDIENDO PROVINCIA*/
SELECT DISTRITO.NOMDIS
FROM DISTRITO
INNER JOIN PROVINCIA ON DISTRITO.PROVINCIA_CODPROV = PROVINCIA.CODPROV
WHERE PROVINCIA.NOMPROV = 'CA&Ntilde;ETE';

SELECT PERSONA.*, DEPARTAMENTO.NOMDEP, PROVINCIA.NOMPROV, DISTRITO.NOMDIS FROM PERSONA
INNER JOIN DISTRITO ON PERSONA.DISTRITO_CODDIS_DISPER=DISTRITO.CODDIS
INNER JOIN PROVINCIA ON DISTRITO.PROVINCIA_CODPROV = PROVINCIA.CODPROV
INNER JOIN DEPARTAMENTO ON PROVINCIA.DEPARTAMENTO_CODDEP = DEPARTAMENTO.CODDEP;

SELECT MARCA.NOMMAR, MODELO.NOMMOD,EMPRESA.RUCEMP, PRODUCTO.NOMPRO, PRODUCTO.SERPRO, PRODUCTO.PREPRO, PRODUCTO.URLIMGPRO, PRODUCTO.ATRIBPRO, FECGARPRO FROM MODELO
INNER JOIN PRODUCTO ON PRODUCTO.MODELO_CODMOD_MODPRO = MODELO.CODMOD
INNER JOIN MARCA ON MODELO.MARCA_CODMAR_MARMOD = MARCA.CODMAR
INNER JOIN EMPRESA ON PRODUCTO.EMPRESA_CODEMP_PROV = EMPRESA.CODEMP;


SELECT VENTA.CODVEN as codigoVenta, PERSONA.NOMPER as vendedor, PERSONA1.NOMPER as comprador, VENTA.FECVEN as fecha, VENTA.HOVEN as hora FROM VENTA
INNER JOIN PERSONA ON VENTA.CODPER_VENVEN = PERSONA.CODPER 
INNER JOIN PERSONA AS PERSONA1 ON VENTA.CODPER_COMVEN = PERSONA1.CODPER;

SELECT VENTA.CODVEN AS codigoVenta, PERSONA.NOMPER as vendedor, PERSONA1.NOMPER as comprador, PRODUCTO.NOMPRO as nombreProducto, MARCA.NOMMAR as marcaProducto, MODELO.NOMMOD as modeloProducto, VENTA_DETALLE.CANTPROVEN as cantidad, PRODUCTO.PREPRO as precio, VENTA_DETALLE.DSCPROVEN as descuento,  (VENTA_DETALLE.CANTPROVEN * PRODUCTO.PREPRO) as total, VENTA.FECVEN as fechaVenta, VENTA.HOVEN as horaVenta
FROM VENTA_DETALLE
INNER JOIN PRODUCTO ON VENTA_DETALLE.PRODUCTO_CODPRO_PROVEN= PRODUCTO.CODPRO
INNER JOIN MODELO ON PRODUCTO.MODELO_CODMOD_MODPRO
INNER JOIN MARCA ON MODELO.MARCA_CODMAR_MARMOD = MARCA.CODMAR
INNER JOIN VENTA ON VENTA_DETALLE.VENTA_CODVEN_VENVEN = VENTA.CODVEN
INNER JOIN PERSONA ON VENTA.CODPER_VENVEN = PERSONA.CODPER 
INNER JOIN PERSONA AS PERSONA1 ON VENTA.CODPER_COMVEN = PERSONA1.CODPER
ORDER BY VENTA.CODVEN ASC;
/*
WHERE VENTA_DETALLE.VENTA_CODVEN_VENVEN = codigoVenta;
*/

SELECT VENTA.CODVEN AS codigoVenta, CONCAT(PERSONA.APEPER,', ',PERSONA.NOMPER) as vendedor, CONCAT(PERSONA1.APEPER,', ',PERSONA1.NOMPER) as comprador, DEPARTAMENTO.NOMDEP as departamentoComprador, PROVINCIA.NOMPROV as provinciaComprador, DISTRITO.NOMDIS as distritoComprador,PERSONA1.DIRPER as direccionComprador, PRODUCTO.NOMPRO as nombreProducto, MARCA.NOMMAR as marcaProducto, MODELO.NOMMOD as modeloProducto, VENTA_DETALLE.CANTPROVEN as cantidad, PRODUCTO.PREPRO as precio,  (VENTA_DETALLE.CANTPROVEN * PRODUCTO.PREPRO) as total, CONCAT(VENTA.FECVEN,' ', VENTA.HOVEN )as fechaVenta
FROM VENTA_DETALLE
INNER JOIN PRODUCTO ON VENTA_DETALLE.PRODUCTO_CODPRO_PROVEN= PRODUCTO.CODPRO
INNER JOIN MODELO ON PRODUCTO.MODELO_CODMOD_MODPRO = MODELO.CODMOD
INNER JOIN MARCA ON MODELO.MARCA_CODMAR_MARMOD = MARCA.CODMAR
INNER JOIN VENTA ON VENTA_DETALLE.VENTA_CODVEN_VENVEN = VENTA.CODVEN
INNER JOIN PERSONA ON VENTA.CODPER_VENVEN = PERSONA.CODPER 
INNER JOIN PERSONA AS PERSONA1 ON VENTA.CODPER_COMVEN = PERSONA1.CODPER
INNER JOIN DISTRITO ON PERSONA1.DISTRITO_CODDIS_DISPER = DISTRITO.CODDIS
INNER JOIN PROVINCIA ON DISTRITO.PROVINCIA_CODPROV = PROVINCIA.CODPROV
INNER JOIN DEPARTAMENTO ON PROVINCIA.DEPARTAMENTO_CODDEP = DEPARTAMENTO.CODDEP
WHERE VENTA.CODVEN = 40;

SELECT CODVEN AS CODIGO, VENTA.CODPER_COMVEN AS COMPRADOR, VENTA.CODPER_VENVEN AS VENDEDOR, CONCAT(FECVEN, ' ',HOVEN) AS FECHAVENTA, IF(TIPVEN='B',0,1) AS TIPOVENTA FROM VENTA;


SELECT PRODUCTO.CODPRO, PRODUCTO.NOMPRO, CATEGORIA.NOMCAT,MARCA.NOMMAR, MODELO.NOMMOD, PRODUCTO.SERPRO, PRODUCTO.FECGARPRO, PRODUCTO.PREPRO, SUM(STOCK.INPSTK)-SUM(STOCK.OUTSTK) AS STOCK FROM MODELO 
INNER JOIN PRODUCTO ON PRODUCTO.MODELO_CODMOD_MODPRO = MODELO.CODMOD
INNER JOIN CATEGORIA ON PRODUCTO.CATEGORIA_CODCAT_CATPRO = CATEGORIA.CODCAT
INNER JOIN MARCA ON MODELO.MARCA_CODMAR_MARMOD = MARCA.CODMAR
LEFT JOIN STOCK ON STOCK.PRODUCTO_CODPRO_PROSTK = PRODUCTO.CODPRO
GROUP BY PRODUCTO.CODPRO;


SELECT PRODUCTO.CODPRO, PRODUCTO.NOMPRO, CATEGORIA.NOMCAT,MARCA.NOMMAR, MODELO.NOMMOD, PRODUCTO.SERPRO, PRODUCTO.FECGARPRO, PRODUCTO.PREPRO, SUM(STOCK.INPSTK)-SUM(STOCK.OUTSTK) AS STOCK FROM MODELO INNER JOIN PRODUCTO ON PRODUCTO.MODELO_CODMOD_MODPRO = MODELO.CODMOD INNER JOIN MARCA ON MODELO.MARCA_CODMAR_MARMOD = MARCA.CODMAR INNER JOIN CATEGORIA ON PRODUCTO.CATEGORIA_CODCAT_CATPRO = CATEGORIA.CODCAT LEFT JOIN STOCK ON STOCK.PRODUCTO_CODPRO_PROSTK = PRODUCTO.CODPRO GROUP BY PRODUCTO.CODPRO HAVING STOCK IS NOT NULL;

SELECT STOCK.CODSTK, STOCK.FECINP, STOCK.FECOUT, PRODUCTO.NOMPRO, STOCK.INPSTK-STOCK.OUTSTK AS CANTIDAD FROM STOCK
INNER JOIN PRODUCTO ON STOCK.PRODUCTO_CODPRO_PROSTK = PRODUCTO.CODPRO
GROUP BY STOCK.CODSTK;


/*Analizar xd*/
SELECT VENTA.CODPER_VENVEN, DAY(VENTA.FECVEN), IF(VENTA.TIPVEN='B',0,1), VENTA.CODPER_COMVEN FROM VENTA
INNER JOIN VENTA_DETALLE ON VENTA_DETALLE.VENTA_CODVEN_VENVEN=VENTA.CODVEN;
