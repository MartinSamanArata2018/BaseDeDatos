-- Created by Vertabelo (http://vertabelo.com)
-- Last modification date: 2019-01-26 17:33:20.538
CREATE DATABASE iVentas CHAR SET UTF8;
USE iVentas;
-- tables
-- Table: DEPARTAMENTO
CREATE TABLE DEPARTAMENTO (
    CODDEP int NOT NULL,
    NOMDEP varchar(50) NOT NULL,
    CONSTRAINT DEPARTAMENTO_pk PRIMARY KEY (CODDEP)
);

-- Table: DETALLE_VENTA
CREATE TABLE DETALLE_VENTA (
    CODDETVEN int NOT NULL,
    PRODUCTO_CODPRO int NOT NULL,
    VENTA_CODVEN int NOT NULL,
    CANTPRODETVEN int NOT NULL,
    DSCPRODETVEN double(2,2) NOT NULL COMMENT 'Descuento',
    ESTDETVEN char(1) NOT NULL,
    CONSTRAINT DETALLE_VENTA_pk PRIMARY KEY (CODDETVEN)
);

-- Table: DISTRITO
CREATE TABLE DISTRITO (
    CODDIS int NOT NULL,
    NOMDIS varchar(50) NOT NULL,
    PROVINCIA_CODPROV int NOT NULL,
    CONSTRAINT DISTRITO_pk PRIMARY KEY (CODDIS)
);

-- Table: EMPRESA
CREATE TABLE EMPRESA (
    CODEMP int NOT NULL AUTO_INCREMENT,
    RUCEMP char(11) NOT NULL,
    TLFEMP char(12) NOT NULL,
    EMAILEMP varchar(30) NOT NULL,
    PERSONA_CODPER_REPLEG int NOT NULL COMMENT 'Representante Legal',
    TIPEMP char(1) NOT NULL COMMENT '1: EIRL
2: SRL
3: SAC
4: SA',
    CONSTRAINT EMPRESA_pk PRIMARY KEY (CODEMP)
);

-- Table: ENTRADASALIDA
CREATE TABLE ENTRADASALIDA (
    CODENSA int NOT NULL,
    PRODUCTO_CODPRO int NOT NULL,
    CNTEN int NOT NULL,
    FECEN date NOT NULL,
    CNTSA int NOT NULL,
    FECSA date NOT NULL,
    STOCK int NOT NULL,
    CONSTRAINT ENTRADASALIDA_pk PRIMARY KEY (CODENSA)
);

-- Table: LOGIN
CREATE TABLE LOGIN (
    CODLOG int NOT NULL AUTO_INCREMENT,
    PERSONA_CODPER int NOT NULL,
    USRLOG varchar(30) NOT NULL,
    PSWLOG varchar(10) NOT NULL,
    ESTLOG char(1) NOT NULL,
    CONSTRAINT LOGIN_pk PRIMARY KEY (CODLOG)
);

-- Table: MARCA
CREATE TABLE MARCA (
    CODMAR int NOT NULL AUTO_INCREMENT,
    NOMMAR varchar(50) NOT NULL,
    CONSTRAINT MARCA_pk PRIMARY KEY (CODMAR)
);

-- Table: MODELO
CREATE TABLE MODELO (
    CODMOD int NOT NULL AUTO_INCREMENT,
    NOMMOD varchar(100) NOT NULL,
    MARCA_CODMAR int NOT NULL,
    CONSTRAINT MODELO_pk PRIMARY KEY (CODMOD)
);

-- Table: PERSONA
CREATE TABLE PERSONA (
    CODPER int NOT NULL AUTO_INCREMENT,
    NOMPER varchar(100) NOT NULL,
    APEPER varchar(100) NOT NULL,
    DNIPER char(8) NOT NULL,
    TLFPER char(12) NOT NULL,
    TIPPER char(1) NOT NULL COMMENT 'A - admin
V - vendedor
C - cliente',
    DISTRITO_CODDIS int NOT NULL,
    DIRPER varchar(50) NOT NULL,
    CONSTRAINT PERSONA_pk PRIMARY KEY (CODPER)
);

-- Table: PRODUCTO
CREATE TABLE PRODUCTO (
    CODPRO int NOT NULL AUTO_INCREMENT,
    NOMPRO varchar(200) NOT NULL,
    MODELO_CODMOD int NOT NULL,
    SERPRO varchar(100) NOT NULL,
    PREPRO double(8,2) NOT NULL,
    URLIMGPRO varchar(300) NOT NULL,
    ATRIBPRO varchar(300) NOT NULL COMMENT 'Caracteristicas del Producto, en JSON:
Procesador, pantalla, resolucion, ram, etc',
    ESTPRO char(1) NOT NULL,
    FECGARPRO date NOT NULL,
    EMPRESA_CODEMP_PROV int NOT NULL COMMENT 'Proveedor del Producto',
    CONSTRAINT PRODUCTO_pk PRIMARY KEY (CODPRO)
)ENGINE=InnoDB;

-- Table: PROVINCIA
CREATE TABLE PROVINCIA (
    CODPROV int NOT NULL,
    NOMPROV varchar(50) NOT NULL,
    DEPARTAMENTO_CODDEP int NOT NULL,
    CONSTRAINT PROVINCIA_pk PRIMARY KEY (CODPROV)
);

-- Table: VENTA
CREATE TABLE VENTA (
    CODVEN int NOT NULL AUTO_INCREMENT,
    CODPERVENVEN int NOT NULL,
    FECVEN date NOT NULL,
    HOVEN time NOT NULL,
    TIPVEN char(1) NOT NULL,
    CODPERCOMVEN int NOT NULL,
    CONSTRAINT VENTA_pk PRIMARY KEY (CODVEN)
);

-- foreign keys
-- Reference: DETALLE_VENTA_PRODUCTO (table: DETALLE_VENTA)
ALTER TABLE DETALLE_VENTA ADD CONSTRAINT DETALLE_VENTA_PRODUCTO FOREIGN KEY DETALLE_VENTA_PRODUCTO (PRODUCTO_CODPRO)
    REFERENCES PRODUCTO (CODPRO);

-- Reference: DETALLE_VENTA_VENTA (table: DETALLE_VENTA)
ALTER TABLE DETALLE_VENTA ADD CONSTRAINT DETALLE_VENTA_VENTA FOREIGN KEY DETALLE_VENTA_VENTA (VENTA_CODVEN)
    REFERENCES VENTA (CODVEN);

-- Reference: DISTRITO_PROVINCIA (table: DISTRITO)
ALTER TABLE DISTRITO ADD CONSTRAINT DISTRITO_PROVINCIA FOREIGN KEY DISTRITO_PROVINCIA (PROVINCIA_CODPROV)
    REFERENCES PROVINCIA (CODPROV);

-- Reference: EMPRESA_PERSONA (table: EMPRESA)
ALTER TABLE EMPRESA ADD CONSTRAINT EMPRESA_PERSONA FOREIGN KEY EMPRESA_PERSONA (PERSONA_CODPER_REPLEG)
    REFERENCES PERSONA (CODPER);

-- Reference: ENTRADASALIDA_PRODUCTO (table: ENTRADASALIDA)
ALTER TABLE ENTRADASALIDA ADD CONSTRAINT ENTRADASALIDA_PRODUCTO FOREIGN KEY ENTRADASALIDA_PRODUCTO (PRODUCTO_CODPRO)
    REFERENCES PRODUCTO (CODPRO);

-- Reference: LOGIN_PERSONA (table: LOGIN)
ALTER TABLE LOGIN ADD CONSTRAINT LOGIN_PERSONA FOREIGN KEY LOGIN_PERSONA (PERSONA_CODPER)
    REFERENCES PERSONA (CODPER);

-- Reference: MODELO_MARCA (table: MODELO)
ALTER TABLE MODELO ADD CONSTRAINT MODELO_MARCA FOREIGN KEY MODELO_MARCA (MARCA_CODMAR)
    REFERENCES MARCA (CODMAR);

-- Reference: PERSONA_DISTRITO (table: PERSONA)
ALTER TABLE PERSONA ADD CONSTRAINT PERSONA_DISTRITO FOREIGN KEY PERSONA_DISTRITO (DISTRITO_CODDIS)
    REFERENCES DISTRITO (CODDIS);

-- Reference: PRODUCTO_EMPRESA (table: PRODUCTO)
ALTER TABLE PRODUCTO ADD CONSTRAINT PRODUCTO_EMPRESA FOREIGN KEY PRODUCTO_EMPRESA (EMPRESA_CODEMP_PROV)
    REFERENCES EMPRESA (CODEMP);

-- Reference: PRODUCTO_MODELO (table: PRODUCTO)
ALTER TABLE PRODUCTO ADD CONSTRAINT PRODUCTO_MODELO FOREIGN KEY PRODUCTO_MODELO (MODELO_CODMOD)
    REFERENCES MODELO (CODMOD);

-- Reference: PROVINCIA_DEPARTAMENTO (table: PROVINCIA)
ALTER TABLE PROVINCIA ADD CONSTRAINT PROVINCIA_DEPARTAMENTO FOREIGN KEY PROVINCIA_DEPARTAMENTO (DEPARTAMENTO_CODDEP)
    REFERENCES DEPARTAMENTO (CODDEP);

-- Reference: VENTA_PERSONA_CODPERCOMVE (table: VENTA)
ALTER TABLE VENTA ADD CONSTRAINT VENTA_PERSONA_CODPERCOMVE FOREIGN KEY VENTA_PERSONA_CODPERCOMVE (CODPERCOMVEN)
    REFERENCES PERSONA (CODPER);

-- Reference: VENTA_PERSONA_CODPERVENVE (table: VENTA)
ALTER TABLE VENTA ADD CONSTRAINT VENTA_PERSONA_CODPERVENVE FOREIGN KEY VENTA_PERSONA_CODPERVENVE (CODPERVENVEN)
    REFERENCES PERSONA (CODPER);

-- End of file.

